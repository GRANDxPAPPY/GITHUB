using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.DirectoryServices;
using System.Drawing;
using System.Text;
using System.Windows.Forms;

namespace WinFormsApp1
{
    public partial class Form3 : Form
    {
        private readonly Inventory _inventory;
        private readonly Product _product;
        BindingSource MyBind = new BindingSource();
        BindingSource AssociatedParts = new BindingSource();



        public Form3()
        {
            InitializeComponent();

        }

        public Form3(Inventory inventory, Product product)
        {
            InitializeComponent();
            _inventory = inventory;
            _product = product;

            MyBind.DataSource = _inventory.AllParts;
            dataGridView1.DataSource = MyBind;

            AssociatedParts.DataSource = _product.AssociatedParts;
            dataGridView2.DataSource = AssociatedParts;
        }



        private void textBox13_TextChanged(object sender, EventArgs e)
        {

        }

        private void button3_Click(object sender, EventArgs e)
        {
            // Cancel Button

            Close();
        }

        private void dataGridView4_CellContentClick(object sender, DataGridViewCellEventArgs e)
        {
            //All  Parts Grid
            // We will be getting data from this on click an appending it to associated parts grid


        }

        private void dataGridView3_CellContentClick(object sender, DataGridViewCellEventArgs e)
        {
            // All Asociated Parts Grid
        }

        private void dataGridView1_CellContentClick(object sender, DataGridViewCellEventArgs e)
        {
            //.addAssociatedParts

            Part userSelect = (Part)dataGridView1.Rows[e.RowIndex].DataBoundItem;

            _product.addAssociatedPart(userSelect);
            AssociatedParts.DataSource = _product.AssociatedParts;
            AssociatedParts.ResetBindings(false);
        }

        private void dataGridView2_CellContentClick(object sender, DataGridViewCellEventArgs e)
        {
            //removeAssociatedPart on click

            Part userSelect = (Part)dataGridView2.Rows[e.RowIndex].DataBoundItem;
            var userSelectID = userSelect.PartID;
            _product.removeAssociatedPart(userSelectID);


            // Refresh the binding to reflect changes
            AssociatedParts.ResetBindings(false);
        }

        private void textbox_search_TextChanged(object sender, EventArgs e)
        {
            // Search Bar textbox
        }

        private void Button_Search_Click(object sender, EventArgs e)
        {
            //Search Button
            //lookpuAssociatedPart




            BindingList<Part> searchResults = new BindingList<Part>();


            if (textbox_search.Text == "")
            {
                AssociatedParts.DataSource = _product.AssociatedParts;
            }
            else
            {
                // Parse ID and lookup Part
                var searchId = Convert.ToInt32(textbox_search.Text);
                var foundPart = _product.lookupAssociatedPart(searchId);

                // Add found Part to results
                if (foundPart != null)
                {
                    searchResults.Add(foundPart);
                }

                AssociatedParts.DataSource = searchResults;
            }

        }




        private void Button_Delete_Click(object sender, EventArgs e)
        {
            //removeAssociatd Part
        }

        private void Button_Save_Click(object sender, EventArgs e)
        {
            //_product.addProduct

            //  making a new product to pass to inventory method
            Product product = new Product();
            product.ProductID = _product.ProductID;
            product.Name = textBox2.Text;
            product.Price = Convert.ToDecimal(textBox4.Text);
            product.InStock = Convert.ToInt32(textBox3.Text);
            product.Min = Convert.ToInt32(textBox5.Text);
            product.Max = Convert.ToInt32(textBox6.Text);
            _inventory.addProduct(product);
        }

        private void textBox2_TextChanged(object sender, EventArgs e)
        {

        }

        private void textBox3_TextChanged(object sender, EventArgs e)
        {

        }

        private void textBox4_TextChanged(object sender, EventArgs e)
        {

        }
    }
}
